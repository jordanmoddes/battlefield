<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Battlefield 6 — All Stats</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab { cursor:pointer }
    .tab[aria-selected="true"] { background-color: rgb(79 70 229); color: white; }
    .card { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08); }
    .metric { font-size: 1.75rem; font-weight: 800; }
    .subtle { color: rgba(199, 210, 254, .8); }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-indigo-900 text-white">
  <div class="max-w-6xl mx-auto p-6">
    <header class="mb-4">
      <h1 class="text-3xl font-extrabold">Battlefield 6 — All Stats (One Page)</h1>
      <p class="subtle text-sm">Platform & gamer tag on the left/right, press LOAD. Page refreshes every 60s.</p>
    </header>

    <!-- Controls -->
    <form id="controls" class="grid grid-cols-1 md:grid-cols-3 gap-3 items-center mb-4">
      <div class="flex items-center gap-2">
        <label for="platform" class="subtle w-24">Platform</label>
        <select id="platform" class="rounded-md border-0 px-3 py-2 text-slate-900 font-medium w-full">
          <option>PC</option><option>Xbox</option><option selected>PS5</option>
        </select>
      </div>
      <div class="flex justify-center">
        <button id="loadBtn" type="button" class="px-5 py-2 rounded-2xl bg-indigo-500 hover:bg-indigo-600 font-semibold">LOAD</button>
      </div>
      <div class="flex items-center gap-2">
        <label for="gamer" class="subtle w-24 text-right">Gamer Tag</label>
        <input id="gamer" value="notJMODsuspended" class="rounded-md px-3 py-2 text-slate-900 w-full" />
      </div>
    </form>

    <!-- Tabs -->
    <div class="flex gap-2 mb-4">
      <button class="tab px-3 py-2 rounded-lg" data-tab="overview" aria-selected="true">Overview</button>
      <button class="tab px-3 py-2 rounded-lg" data-tab="modes">Modes</button>
      <button class="tab px-3 py-2 rounded-lg" data-tab="gadgets">Top Gadgets</button>
      <button class="tab px-3 py-2 rounded-lg" data-tab="weapons">Top Weapons</button>
    </div>

    <!-- Panels -->
    <section id="panel-overview" class="space-y-4">
      <div class="card p-4 rounded-2xl">
        <div class="flex items-center justify-between">
          <div>
            <div class="text-xl font-semibold" id="ov-name">—</div>
            <div class="subtle" id="ov-hours">—</div>
          </div>
          <div class="text-right subtle">
            <div id="ov-platform">—</div>
          </div>
        </div>
        <hr class="my-3 border-white/10">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
          <div class="card p-4 rounded-xl"><div class="subtle">Kills</div><div class="metric" id="kills">—</div><div class="subtle" id="kills-rank"></div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">Deaths</div><div class="metric" id="deaths">—</div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">Assists</div><div class="metric" id="assists">—</div><div class="subtle" id="assists-rank"></div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">Revives</div><div class="metric" id="revives">—</div><div class="subtle" id="revives-rank"></div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">W/L Ratio</div><div class="metric" id="wl">—</div><div class="subtle" id="wl-rank"></div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">Kills / Match</div><div class="metric" id="kpmatch">—</div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">K/D Ratio</div><div class="metric" id="kd">—</div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">Kills / Minute</div><div class="metric" id="kpm">—</div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">Best Class</div><div class="metric" id="best-class">—</div><div class="subtle" id="best-class-detail"></div></div>
          <div class="card p-4 rounded-xl"><div class="subtle">Rank</div><div class="metric" id="rank">—</div><div class="subtle" id="xp-matches"></div></div>
        </div>
      </div>
    </section>

    <section id="panel-modes" class="hidden space-y-3">
      <div id="modes" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
    </section>

    <section id="panel-gadgets" class="hidden">
      <div id="gadgets" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
    </section>

    <section id="panel-weapons" class="hidden">
      <div id="weapons" class="grid grid-cols-1 md:grid-cols-2 gap-3"></div>
    </section>

    <footer class="mt-6 text-xs subtle">
      Status: <span id="status">idle</span>
    </footer>
  </div>

  <script>
    // ===== CONFIG =====
    // After you deploy the worker below, set this to its URL (e.g., https://YOURNAME.workers.dev)
    const API_BASE = "https://YOUR-WORKER-URL"; // <-- change me after deploying worker

    // Tabs
    document.querySelectorAll(".tab").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab").forEach(b => b.setAttribute("aria-selected","false"));
        btn.setAttribute("aria-selected","true");
        const tab = btn.dataset.tab;
        ["overview","modes","gadgets","weapons"].forEach(t => {
          document.getElementById(`panel-${t}`).classList.toggle("hidden", t!==tab);
        });
      });
    });

    const statusEl = document.getElementById("status");
    const loadBtn = document.getElementById("loadBtn");
    const platformEl = document.getElementById("platform");
    const gamerEl = document.getElementById("gamer");

    async function loadAll() {
      statusEl.textContent = "loading…";
      try {
        const url = `${API_BASE}/api/summary?platform=${encodeURIComponent(platformEl.value)}&tag=${encodeURIComponent(gamerEl.value)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("API error");
        const data = await res.json();
        renderAll(data);
        statusEl.textContent = "loaded";
      } catch (e) {
        console.error(e);
        statusEl.textContent = "error";
      }
    }

    function renderAll(d) {
      // Overview
      byId("ov-name").textContent = d.player.name;
      byId("ov-hours").textContent = `${d.player.hours} HOURS`;
      byId("ov-platform").textContent = d.player.platform;
      setMetric("kills", d.overview.kills, d.overview.killsRank);
      setMetric("deaths", d.overview.deaths);
      setMetric("assists", d.overview.assists, d.overview.assistsRank);
      setMetric("revives", d.overview.revives, d.overview.revivesRank);
      setMetric("wl", `${d.overview.wl.toFixed(1)}%`, `Top ${d.overview.wlRank}`);
      setMetric("kpmatch", d.overview.killsPerMatch.toFixed(2));
      setMetric("kd", d.overview.kd.toFixed(2));
      setMetric("kpm", d.overview.kpm.toFixed(2));
      byId("best-class").textContent = d.overview.bestClass.name;
      byId("best-class-detail").textContent = `${d.overview.bestClass.kills} kills | ${d.overview.bestClass.hours} hours`;
      byId("rank").textContent = d.overview.rank.toString();
      byId("xp-matches").textContent = `XP: ${d.overview.xp.toLocaleString()} | Matches: ${d.overview.matches}`;

      // Modes
      const modes = document.getElementById("modes");
      modes.innerHTML = d.modes.map(m => card(`
        <div class="text-lg font-semibold">${m.name}</div>
        <div class="grid grid-cols-2 gap-2 mt-2">
          <div><div class="subtle">Kills</div><div class="metric">${m.kills}</div></div>
          <div><div class="subtle">KPM</div><div class="metric">${m.kpm.toFixed(2)}</div></div>
          <div><div class="subtle">Wins</div><div class="metric">${m.wins}</div></div>
          <div><div class="subtle">Losses</div><div class="metric">${m.losses}</div></div>
          <div><div class="subtle">W/L</div><div class="metric">${m.wl.toFixed(1)}%</div></div>
          <div><div class="subtle">Matches</div><div class="metric">${m.matches}</div></div>
          <div><div class="subtle">Objective</div><div class="metric">${m.objectiveHours}h</div></div>
          <div><div class="subtle">Time</div><div class="metric">${m.hours}h</div></div>
        </div>
      `)).join("");

      // Gadgets
      const gadgets = document.getElementById("gadgets");
      gadgets.innerHTML = grid2(d.gadgets.map(g => card(`
        <div class="text-lg font-semibold">${g.name}</div>
        <div class="mt-2"><span class="metric">${g.kills}</span> <span class="subtle">kills</span></div>
        <div class="subtle">${g.kpm.toFixed(2)} KPM | ${g.hours} hour${g.hours===1?"":"s"}</div>
      `)));

      // Weapons
      const weapons = document.getElementById("weapons");
      weapons.innerHTML = grid2(d.weapons.map(w => card(`
        <div class="text-lg font-semibold">${w.name}</div>
        <div class="mt-2"><span class="metric">${w.kills}</span> <span class="subtle">kills</span></div>
        <div class="subtle">${(w.acc*100).toFixed(1)}% accuracy | ${w.kpm.toFixed(2)} KPM</div>
      `)));
    }

    function byId(id){ return document.getElementById(id); }
    function setMetric(id, value, rankText){
      byId(id).textContent = typeof value === "number" ? value.toLocaleString() : value;
      const r = byId(`${id}-rank`); if(r) r.textContent = rankText || "";
    }
    const card = inner => `<div class="card p-4 rounded-xl">${inner}</div>`;
    const grid2 = items => `<div class="grid grid-cols-1 md:grid-cols-2 gap-3">${items.join("")}</div>`;

    // Events + polling
    loadBtn.addEventListener("click", ()=>{ loadAll(); startPolling(); });
    let poll; function startPolling(){ stopPolling(); poll=setInterval(loadAll, 60_000); }
    function stopPolling(){ if(poll) clearInterval(poll), poll=null; }

    // First render
    loadAll();
  </script>
</body>
</html>
